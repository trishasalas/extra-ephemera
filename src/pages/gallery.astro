---
import { CldImage } from 'astro-cloudinary';
import Layout from '../layouts/Layout.astro';
import galleryData from '../data/gallery.json';

// Type for cached gallery images
interface GalleryImage {
    asset_id: string;
    public_id: string;
    format: string;
    width: number;
    height: number;
    display_name: string;
    created_at: string;
}

interface GalleryData {
    folder: string;
    updated_at: string;
    count: number;
    images: GalleryImage[];
}

const data = galleryData as GalleryData;
const gallery_images = data.images;

const debug = {
    folder: data.folder,
    count: data.count,
    updated_at: data.updated_at,
};
---

<Layout title="Extra Ephemera Gallery">
    <main class="max-w-5xl mx-auto my-12 px-6">
        <header class="mb-12">
            <h1 class="text-4xl font-black mb-2">Extra Ephemera Gallery</h1>
        </header>

        <details class="mb-8 border rounded p-4 bg-slate-50">
            <summary class="cursor-pointer font-semibold">Debug: Gallery Cache</summary>
            <ul class="mt-3 text-sm leading-6">
                <li><strong>Folder:</strong> {debug.folder}</li>
                <li><strong>Cached images:</strong> {debug.count}</li>
                <li><strong>Last updated:</strong> {new Date(debug.updated_at).toLocaleString()}</li>
                <li class="text-slate-500 mt-2">Run <code class="bg-slate-200 px-1 rounded">npm run refresh-gallery</code> to update</li>
            </ul>
        </details>

        <h2 class="text-2xl font-bold mb-3">Gallery</h2>

        {gallery_images && gallery_images.length > 0 ? (
            <ul class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-12">
                {gallery_images.map((img) => (
                    <li class="aspect-square overflow-hidden rounded-lg">
                        <CldImage
                            src={img.public_id}
                            width={img.width}
                            height={img.height}
                            alt={img.display_name || ''}
                            sizes="25vw"
                            class="w-full h-full object-cover"
                        />
                    </li>
                ))}
            </ul>
        ) : (
            <p class="text-slate-600 mb-12">
                No images found. Run <code>npm run refresh-gallery</code> to fetch images from Cloudinary.
            </p>
        )}
    </main>
</Layout>
